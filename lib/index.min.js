import{register}from"node:module";import{existsSync,statSync}from"node:fs";import{dirname,extname,resolve as resolvePath}from"node:path";register(new URL(import.meta.url));const extensions=[".js",".mjs",".json",".jsx",".d.ts",".ts",".tsx"],mapTo=process.env.BYE_ESM_EXT_MAP_ROOT_TO;let rootDir="",outDir="";if(mapTo){const[e,t]=mapTo.split(":");if(e&&t){const s=process.cwd();rootDir="/"===e[0]?resolvePath(e):resolvePath(s,e),outDir="/"===t[0]?resolvePath(t):resolvePath(s,t)}}export const resolve=(e,t,s)=>{const o=extname(e);if((!o||!extensions.includes(o))&&t.parentURL?.startsWith("file://")){const o=t.parentURL.substring(7);let r=dirname(o);rootDir&&r.startsWith(rootDir)&&(r=r.replace(rootDir,outDir));let i=resolvePath(r,e);if(existsSync(i)){if(statSync(i).isDirectory())for(const e of extensions)if(i=resolvePath(i,`index${e}`),existsSync(i))return s(`file://${i}`,t)}else for(const o of extensions)if(i=resolvePath(r,e+o),existsSync(i))return s(`file://${i}`,t)}return s(e,t)};